---
- include_vars:
    file: freeipa.yml

- name: install required packages
  become: True
  apt:
    name: "{{ item }}"
    state: present
    update_cache: yes
    cache_valid_time: 1800
  with_items:
    - krb5-user

- name: set nisdomainname
  become: True
  sysctl:
    name: kernel.domainname
    value: "{{ freeipa.domain }}"
    state: present

- name: generate krb5.conf
  become: True
  template:
    src: etc_krb5.conf.j2
    dest: /etc/krb5.conf
    owner: root
    group: root
    mode: 0644
  notify: restart sssd
